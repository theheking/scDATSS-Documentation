

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Investigating Gene Pathway Enrichment with Spectra &mdash; Isoform Specific Perturb-Seq  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css?v=2aa19091" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../_static/doctools.js?v=fd6eb6e6"></script>
      <script src="../../_static/sphinx_highlight.js?v=6ffebe34"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=f281be69"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@4/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Investigating Copy Number Variation Across KD Populations" href="9A_cnv_score.html" />
    <link rel="prev" title="Cell Assignment Model from FUCCI-Matched Single-Cell Paper" href="7_cellphase_model.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Isoform Specific Perturb-Seq
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Analysis Pipeline:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../promoter_identification.html">Promoter Identification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guide_design.html">Promoter Specific Guide Design</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../analysis_scripts.html">Analysis Scripts &amp; Pipelines</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../analysis_scripts.html#preprocessing-guide-calling">Preprocessing &amp; Guide Calling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../analysis_scripts.html#transcript-quantification">Transcript Quantification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../analysis_scripts.html#transcriptional-divergence-e-stats-differential-expression">Transcriptional Divergence (E-Stats &amp; Differential Expression)</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../analysis_scripts.html#cell-phase-pathway-modeling">Cell Phase &amp; Pathway Modeling</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="7_cellphase_model.html">Cell Assignment Model from FUCCI-Matched Single-Cell Paper</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Investigating Gene Pathway Enrichment with Spectra</a></li>
<li class="toctree-l3"><a class="reference internal" href="9A_cnv_score.html">Investigating Copy Number Variation Across KD Populations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../analysis_scripts.html#clinical-promoter-prevalence">Clinical &amp; Promoter Prevalence</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Isoform Specific Perturb-Seq</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../analysis_scripts.html">Analysis Scripts &amp; Pipelines</a></li>
      <li class="breadcrumb-item active">Investigating Gene Pathway Enrichment with Spectra</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/scripts/3_analysis_scripts/11_spectra.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Investigating-Gene-Pathway-Enrichment-with-Spectra">
<h1>Investigating Gene Pathway Enrichment with Spectra<a class="headerlink" href="#Investigating-Gene-Pathway-Enrichment-with-Spectra" title="Link to this heading"></a></h1>
<p>This notebook uses Spectra to translate raw gene expression into interpretable biological scores. It then uses those scores to test the hypothesis that specific ESR1 perturbations alter cell cycle transitions. The results suggest a detailed look at how different promoters or guides for the same target gene might result in different phenotypic (biological program) outcomes.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#read in the</span>
<span class="c1">#import packages</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scanpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sc</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1">#spectra imports</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">Spectra</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">spc</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">Spectra</span><span class="w"> </span><span class="kn">import</span> <span class="n">Spectra_util</span> <span class="k">as</span> <span class="n">spc_tl</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">Spectra</span><span class="w"> </span><span class="kn">import</span> <span class="n">K_est</span> <span class="k">as</span> <span class="n">kst</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">Spectra</span><span class="w"> </span><span class="kn">import</span> <span class="n">default_gene_sets</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">anndata</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ad</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#form a location</span>
<span class="n">loc</span><span class="o">=</span><span class="s2">&quot;alt-prom-crispr-fiveprime/&quot;</span>
<span class="c1">#load adata</span>
<span class="n">adata</span>  <span class="o">=</span> <span class="n">ad</span><span class="o">.</span><span class="n">read_h5ad</span><span class="p">(</span><span class="n">loc</span><span class="o">+</span><span class="s2">&quot;files/adata_normalised_cellcycle.h5ad&quot;</span><span class="p">)</span>
<span class="n">adata</span><span class="o">.</span><span class="n">X</span><span class="o">=</span><span class="n">adata</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="s2">&quot;log1p&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">annotations</span> <span class="o">=</span> <span class="n">spc</span><span class="o">.</span><span class="n">default_gene_sets</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="c1">#fit the model (We will run this with only 2 epochs to decrease runtime in this tutorial)</span>
<span class="n">model_global</span> <span class="o">=</span> <span class="n">spc</span><span class="o">.</span><span class="n">est_spectra</span><span class="p">(</span><span class="n">adata</span> <span class="o">=</span> <span class="n">adata</span><span class="p">,</span> <span class="n">gene_set_dictionary</span> <span class="o">=</span> <span class="n">annotations</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">],</span> <span class="c1"># because we do not use the cell types</span>
                                                                                    <span class="c1"># we will supply a regular dict</span>
                                                                                    <span class="c1"># instead of the nested dict above</span>
                        <span class="n">use_highly_variable</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">cell_type_key</span> <span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1">#&quot;cell_type_annotations&quot; ,</span>
                        <span class="n">use_weights</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">lam</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
                        <span class="n">delta</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
                        <span class="n">kappa</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">,</span> <span class="c1">#change to None 0.00001</span>
                        <span class="n">rho</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span> <span class="c1">#rho 0.00001</span>
                        <span class="n">use_cell_types</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="c1">#set to False to not use the cell type annotations</span>
                        <span class="n">n_top_vals</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>  <span class="c1">#number set to 50</span>
                        <span class="n">clean_gs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">label_factors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">num_epochs</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
                        <span class="n">overlap_threshold</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                        <span class="n">min_gs_num</span> <span class="o">=</span> <span class="mi">3</span>
                       <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Cell type labels in gene set annotation dictionary and AnnData object are identical
removing gene set all_Beta-Ala_metabolism for cell type global which is of length 7 2 genes are found in the data. minimum length is 3
removing gene set all_ascorbate-uptake for cell type global which is of length 3 2 genes are found in the data. minimum length is 3
Your gene set annotation dictionary is now correctly formatted.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|██████████| 10000/10000 [2:05:26&lt;00:00,  1.33it/s]
/Users/helenking/anaconda3/envs/apu/lib/python3.12/site-packages/Spectra/Spectra.py:1340: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value &#39;BTD&#39; has dtype incompatible with float64, please explicitly cast to a compatible dtype first.
  df.iloc[i,j] = id2word[idx_matrix[i,j]]
/Users/helenking/anaconda3/envs/apu/lib/python3.12/site-packages/Spectra/Spectra.py:1340: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value &#39;HLCS&#39; has dtype incompatible with float64, please explicitly cast to a compatible dtype first.
  df.iloc[i,j] = id2word[idx_matrix[i,j]]
/Users/helenking/anaconda3/envs/apu/lib/python3.12/site-packages/Spectra/Spectra.py:1340: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value &#39;TECR&#39; has dtype incompatible with float64, please explicitly cast to a compatible dtype first.
  df.iloc[i,j] = id2word[idx_matrix[i,j]]
/Users/helenking/anaconda3/envs/apu/lib/python3.12/site-packages/Spectra/Spectra.py:1340: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value &#39;TFRC&#39; has dtype incompatible with float64, please explicitly cast to a compatible dtype first.
  df.iloc[i,j] = id2word[idx_matrix[i,j]]
/Users/helenking/anaconda3/envs/apu/lib/python3.12/site-packages/Spectra/Spectra.py:1340: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value &#39;P4HB&#39; has dtype incompatible with float64, please explicitly cast to a compatible dtype first.
  df.iloc[i,j] = id2word[idx_matrix[i,j]]
/Users/helenking/anaconda3/envs/apu/lib/python3.12/site-packages/Spectra/Spectra.py:1340: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value &#39;CDH1&#39; has dtype incompatible with float64, please explicitly cast to a compatible dtype first.
  df.iloc[i,j] = id2word[idx_matrix[i,j]]
/Users/helenking/anaconda3/envs/apu/lib/python3.12/site-packages/Spectra/Spectra.py:1340: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value &#39;HSPA5&#39; has dtype incompatible with float64, please explicitly cast to a compatible dtype first.
  df.iloc[i,j] = id2word[idx_matrix[i,j]]
/Users/helenking/anaconda3/envs/apu/lib/python3.12/site-packages/Spectra/Spectra.py:1340: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value &#39;CTSD&#39; has dtype incompatible with float64, please explicitly cast to a compatible dtype first.
  df.iloc[i,j] = id2word[idx_matrix[i,j]]
/Users/helenking/anaconda3/envs/apu/lib/python3.12/site-packages/Spectra/Spectra.py:1340: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value &#39;PDIA6&#39; has dtype incompatible with float64, please explicitly cast to a compatible dtype first.
  df.iloc[i,j] = id2word[idx_matrix[i,j]]
/Users/helenking/anaconda3/envs/apu/lib/python3.12/site-packages/Spectra/Spectra.py:1340: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value &#39;SCD&#39; has dtype incompatible with float64, please explicitly cast to a compatible dtype first.
  df.iloc[i,j] = id2word[idx_matrix[i,j]]
/Users/helenking/anaconda3/envs/apu/lib/python3.12/site-packages/Spectra/Spectra.py:1340: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value &#39;BMP7&#39; has dtype incompatible with float64, please explicitly cast to a compatible dtype first.
  df.iloc[i,j] = id2word[idx_matrix[i,j]]
/Users/helenking/anaconda3/envs/apu/lib/python3.12/site-packages/Spectra/Spectra.py:1340: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value &#39;IGFBP2&#39; has dtype incompatible with float64, please explicitly cast to a compatible dtype first.
  df.iloc[i,j] = id2word[idx_matrix[i,j]]
/Users/helenking/anaconda3/envs/apu/lib/python3.12/site-packages/Spectra/Spectra.py:1340: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value &#39;SLC5A6&#39; has dtype incompatible with float64, please explicitly cast to a compatible dtype first.
  df.iloc[i,j] = id2word[idx_matrix[i,j]]
/Users/helenking/anaconda3/envs/apu/lib/python3.12/site-packages/Spectra/Spectra.py:1340: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value &#39;ACSL3&#39; has dtype incompatible with float64, please explicitly cast to a compatible dtype first.
  df.iloc[i,j] = id2word[idx_matrix[i,j]]
/Users/helenking/anaconda3/envs/apu/lib/python3.12/site-packages/Spectra/Spectra.py:1340: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value &#39;ITGA2&#39; has dtype incompatible with float64, please explicitly cast to a compatible dtype first.
  df.iloc[i,j] = id2word[idx_matrix[i,j]]
/Users/helenking/anaconda3/envs/apu/lib/python3.12/site-packages/Spectra/Spectra.py:1340: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value &#39;LAMP2&#39; has dtype incompatible with float64, please explicitly cast to a compatible dtype first.
  df.iloc[i,j] = id2word[idx_matrix[i,j]]
/Users/helenking/anaconda3/envs/apu/lib/python3.12/site-packages/Spectra/Spectra.py:1340: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value &#39;CYP51A1&#39; has dtype incompatible with float64, please explicitly cast to a compatible dtype first.
  df.iloc[i,j] = id2word[idx_matrix[i,j]]
/Users/helenking/anaconda3/envs/apu/lib/python3.12/site-packages/Spectra/Spectra.py:1340: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value &#39;NPY1R&#39; has dtype incompatible with float64, please explicitly cast to a compatible dtype first.
  df.iloc[i,j] = id2word[idx_matrix[i,j]]
/Users/helenking/anaconda3/envs/apu/lib/python3.12/site-packages/Spectra/Spectra.py:1340: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value &#39;EFEMP1&#39; has dtype incompatible with float64, please explicitly cast to a compatible dtype first.
  df.iloc[i,j] = id2word[idx_matrix[i,j]]
/Users/helenking/anaconda3/envs/apu/lib/python3.12/site-packages/Spectra/Spectra.py:1340: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value &#39;CKAP4&#39; has dtype incompatible with float64, please explicitly cast to a compatible dtype first.
  df.iloc[i,j] = id2word[idx_matrix[i,j]]
/Users/helenking/anaconda3/envs/apu/lib/python3.12/site-packages/Spectra/Spectra.py:1340: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value &#39;ITGB1&#39; has dtype incompatible with float64, please explicitly cast to a compatible dtype first.
  df.iloc[i,j] = id2word[idx_matrix[i,j]]
/Users/helenking/anaconda3/envs/apu/lib/python3.12/site-packages/Spectra/Spectra.py:1340: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value &#39;EPCAM&#39; has dtype incompatible with float64, please explicitly cast to a compatible dtype first.
  df.iloc[i,j] = id2word[idx_matrix[i,j]]
/Users/helenking/anaconda3/envs/apu/lib/python3.12/site-packages/Spectra/Spectra.py:1340: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value &#39;CD9&#39; has dtype incompatible with float64, please explicitly cast to a compatible dtype first.
  df.iloc[i,j] = id2word[idx_matrix[i,j]]
/Users/helenking/anaconda3/envs/apu/lib/python3.12/site-packages/Spectra/Spectra.py:1340: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value &#39;HEXB&#39; has dtype incompatible with float64, please explicitly cast to a compatible dtype first.
  df.iloc[i,j] = id2word[idx_matrix[i,j]]
/Users/helenking/anaconda3/envs/apu/lib/python3.12/site-packages/Spectra/Spectra.py:1340: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value &#39;PRDX4&#39; has dtype incompatible with float64, please explicitly cast to a compatible dtype first.
  df.iloc[i,j] = id2word[idx_matrix[i,j]]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># KeyError: &quot;Could not find &#39;umap&#39; or &#39;X_umap&#39; in .obsm&quot;</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="n">use_rep</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
<span class="n">sc</span><span class="o">.</span><span class="n">tl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
OMP: Info #276: omp_set_nested routine deprecated, please use omp_set_max_active_levels instead.
/Users/helenking/anaconda3/envs/apu/lib/python3.12/site-packages/tqdm/auto.py:21: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html
  from .autonotebook import tqdm as notebook_tqdm
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataframe_spectra</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">obsm</span><span class="p">[</span><span class="s2">&quot;SPECTRA_cell_scores&quot;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">adata</span><span class="o">.</span><span class="n">obs_names</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">adata</span><span class="o">.</span><span class="n">uns</span><span class="p">[</span><span class="s2">&quot;SPECTRA_overlap&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">dataframe_spectra_columns</span><span class="o">=</span><span class="n">adata</span><span class="o">.</span><span class="n">uns</span><span class="p">[</span><span class="s2">&quot;SPECTRA_overlap&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
<span class="c1">#subset the dataframe for the cellbarcodes of ESR1_P1 ESR1_P2 and nontargeting</span>
<span class="n">gene</span><span class="o">=</span><span class="s2">&quot;ESR1&quot;</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataframe_spectra</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0-X-global-X-all_biotin_metabolism</th>
      <th>1-X-global-X-all_purine_synthesis</th>
      <th>2-X-global-X-all_ethanol_metabolism</th>
      <th>3-X-global-X-all_amino-sugar-nucleotide-sugar_metabolism</th>
      <th>4-X-global-X-all_steroid_metabolism</th>
      <th>5-X-global-X-all_carnitine-shuttle</th>
      <th>6-X-global-X-all_TLR_signaling</th>
      <th>7-X-global-X-all_phosphoinositide_signaling</th>
      <th>8-X-global-X-all_microautophagy-lysosomal</th>
      <th>9-X-global-X-9</th>
      <th>...</th>
      <th>139-X-global-X-139</th>
      <th>140-X-global-X-all_galactose_metabolism</th>
      <th>141-X-global-X-all_MYC_targets</th>
      <th>142-X-global-X-all_GLU_metabolism</th>
      <th>143-X-global-X-all_fatty-acid_synthesis</th>
      <th>144-X-global-X-all_pentose-phosphate-pathway</th>
      <th>145-X-global-X-all_ros_response</th>
      <th>146-X-global-X-all_IL6-JAK-STAT3_signaling</th>
      <th>147-X-global-X-all_autophagy-chaperone-mediated</th>
      <th>148-X-global-X-148</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>GTGTGCGGTTAGTGGG-1</th>
      <td>9.237579e-03</td>
      <td>4.053838e-04</td>
      <td>4.750246e-11</td>
      <td>5.322683e-04</td>
      <td>5.557497e-09</td>
      <td>4.248724e-10</td>
      <td>7.161847e-04</td>
      <td>3.075701e-07</td>
      <td>3.413473e-11</td>
      <td>2.085672e-02</td>
      <td>...</td>
      <td>6.090823e-03</td>
      <td>1.323262e-10</td>
      <td>0.000388</td>
      <td>2.880409e-04</td>
      <td>0.003124</td>
      <td>0.029767</td>
      <td>3.956140e-07</td>
      <td>0.000363</td>
      <td>0.057384</td>
      <td>0.027820</td>
    </tr>
    <tr>
      <th>TCAGATGAGCATCATC-1</th>
      <td>7.051101e-09</td>
      <td>1.662875e-04</td>
      <td>5.717598e-04</td>
      <td>1.144720e-04</td>
      <td>3.238609e-04</td>
      <td>1.071320e-04</td>
      <td>5.162545e-04</td>
      <td>3.040417e-04</td>
      <td>1.782021e-04</td>
      <td>2.538253e-03</td>
      <td>...</td>
      <td>4.685277e-03</td>
      <td>1.341369e-10</td>
      <td>0.000818</td>
      <td>1.632836e-10</td>
      <td>0.002828</td>
      <td>0.041279</td>
      <td>5.058674e-04</td>
      <td>0.000398</td>
      <td>0.052450</td>
      <td>0.028108</td>
    </tr>
    <tr>
      <th>GCAATCACACGACGAA-1</th>
      <td>2.167318e-03</td>
      <td>3.691382e-04</td>
      <td>4.885835e-11</td>
      <td>3.279115e-04</td>
      <td>4.265923e-04</td>
      <td>1.508868e-04</td>
      <td>3.599413e-04</td>
      <td>2.189579e-04</td>
      <td>1.859391e-04</td>
      <td>2.479209e-03</td>
      <td>...</td>
      <td>1.467027e-02</td>
      <td>2.486610e-04</td>
      <td>0.001294</td>
      <td>1.383442e-04</td>
      <td>0.002948</td>
      <td>0.031350</td>
      <td>3.599227e-04</td>
      <td>0.000401</td>
      <td>0.044456</td>
      <td>0.027079</td>
    </tr>
    <tr>
      <th>CACACAAAGCTGCAAG-1</th>
      <td>1.413153e-03</td>
      <td>3.007432e-04</td>
      <td>1.872481e-03</td>
      <td>3.030962e-04</td>
      <td>2.353136e-04</td>
      <td>1.626892e-09</td>
      <td>1.210399e-09</td>
      <td>2.119303e-04</td>
      <td>2.140315e-10</td>
      <td>3.126384e-03</td>
      <td>...</td>
      <td>4.533910e-03</td>
      <td>4.900877e-10</td>
      <td>0.002375</td>
      <td>2.924478e-10</td>
      <td>0.008609</td>
      <td>0.031775</td>
      <td>2.660242e-04</td>
      <td>0.000281</td>
      <td>0.052374</td>
      <td>0.020489</td>
    </tr>
    <tr>
      <th>AGGCCACTCTTACCTA-1</th>
      <td>1.927258e-10</td>
      <td>2.121895e-04</td>
      <td>1.418944e-03</td>
      <td>3.032002e-08</td>
      <td>7.462370e-04</td>
      <td>3.291458e-10</td>
      <td>8.620481e-04</td>
      <td>6.641354e-04</td>
      <td>1.497885e-09</td>
      <td>2.075204e-02</td>
      <td>...</td>
      <td>4.979285e-10</td>
      <td>2.278506e-04</td>
      <td>0.001540</td>
      <td>2.485600e-04</td>
      <td>0.007542</td>
      <td>0.030187</td>
      <td>2.048542e-04</td>
      <td>0.000002</td>
      <td>0.063139</td>
      <td>0.023481</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>TAGCCGGAGCGTAATA-1</th>
      <td>7.170779e-11</td>
      <td>7.430381e-07</td>
      <td>1.470620e-03</td>
      <td>7.200462e-09</td>
      <td>2.873440e-04</td>
      <td>1.814014e-04</td>
      <td>5.772967e-04</td>
      <td>4.233786e-09</td>
      <td>4.460185e-11</td>
      <td>5.374444e-03</td>
      <td>...</td>
      <td>3.734831e-07</td>
      <td>1.968945e-04</td>
      <td>0.002929</td>
      <td>2.826797e-04</td>
      <td>0.004844</td>
      <td>0.042471</td>
      <td>2.920751e-04</td>
      <td>0.000505</td>
      <td>0.047386</td>
      <td>0.015173</td>
    </tr>
    <tr>
      <th>CTTGGCTTCAGCTTAG-1</th>
      <td>2.476367e-03</td>
      <td>2.263839e-04</td>
      <td>1.547956e-03</td>
      <td>4.779655e-04</td>
      <td>3.421056e-08</td>
      <td>1.699237e-09</td>
      <td>3.557669e-04</td>
      <td>3.625548e-04</td>
      <td>6.701469e-10</td>
      <td>3.329656e-03</td>
      <td>...</td>
      <td>4.498193e-07</td>
      <td>1.046996e-04</td>
      <td>0.001219</td>
      <td>2.700598e-04</td>
      <td>0.007622</td>
      <td>0.046131</td>
      <td>1.096286e-07</td>
      <td>0.000291</td>
      <td>0.000048</td>
      <td>0.036125</td>
    </tr>
    <tr>
      <th>CATATGGAGGTGTTAA-1</th>
      <td>2.570778e-03</td>
      <td>2.000376e-04</td>
      <td>1.210368e-03</td>
      <td>2.292907e-04</td>
      <td>3.842223e-04</td>
      <td>2.233571e-10</td>
      <td>2.944821e-04</td>
      <td>3.124280e-04</td>
      <td>3.961496e-11</td>
      <td>7.104835e-03</td>
      <td>...</td>
      <td>9.437590e-04</td>
      <td>1.307871e-08</td>
      <td>0.000536</td>
      <td>5.709161e-04</td>
      <td>0.013282</td>
      <td>0.033105</td>
      <td>7.381341e-04</td>
      <td>0.000377</td>
      <td>0.049024</td>
      <td>0.026089</td>
    </tr>
    <tr>
      <th>TCTCTAAAGGAGCGTT-1</th>
      <td>1.391553e-03</td>
      <td>3.627104e-04</td>
      <td>9.115024e-11</td>
      <td>1.524916e-04</td>
      <td>2.003262e-08</td>
      <td>5.953464e-10</td>
      <td>5.397420e-04</td>
      <td>1.982464e-04</td>
      <td>1.601765e-11</td>
      <td>6.056628e-03</td>
      <td>...</td>
      <td>1.611285e-06</td>
      <td>3.034562e-10</td>
      <td>0.000512</td>
      <td>3.202521e-04</td>
      <td>0.000006</td>
      <td>0.045093</td>
      <td>7.756426e-04</td>
      <td>0.000383</td>
      <td>0.055106</td>
      <td>0.027756</td>
    </tr>
    <tr>
      <th>GGGAATGTCTTGACGA-1</th>
      <td>2.001940e-10</td>
      <td>2.734928e-04</td>
      <td>1.260464e-03</td>
      <td>5.065035e-04</td>
      <td>2.395792e-04</td>
      <td>1.043869e-04</td>
      <td>3.210498e-04</td>
      <td>5.566190e-04</td>
      <td>4.005243e-11</td>
      <td>4.522674e-07</td>
      <td>...</td>
      <td>2.066875e-07</td>
      <td>2.202848e-04</td>
      <td>0.001907</td>
      <td>2.936413e-04</td>
      <td>0.008942</td>
      <td>0.045249</td>
      <td>9.947184e-04</td>
      <td>0.000402</td>
      <td>0.045627</td>
      <td>0.018386</td>
    </tr>
  </tbody>
</table>
<p>27929 rows × 149 columns</p>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s2">&quot;guide_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="c1">#get a list of genes</span>
<span class="n">gene_list</span> <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">][(</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s2">&quot;guide_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;AP&quot;</span><span class="p">))</span><span class="o">&amp;</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s2">&quot;guide_id&quot;</span><span class="p">]</span><span class="o">!=</span><span class="s2">&quot;non-targeting_Control&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataframe_spectra_gene</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">dataframe_spectra_gene</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;transition&quot;</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Index([&#39;12-X-global-X-all_G2M-transition&#39;, &#39;80-X-global-X-all_G1S-transition&#39;], dtype=&#39;object&#39;)
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#subselect only the the index beginning with 10 and 79</span>
<span class="c1">#subset esr1 transtion</span>
<span class="n">dataframe_spectra_gene</span><span class="o">=</span><span class="n">dataframe_spectra</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dataframe_spectra_gene_sub</span><span class="o">=</span><span class="n">dataframe_spectra_gene</span><span class="p">[[</span><span class="s2">&quot;guide_id&quot;</span><span class="p">,</span><span class="s2">&quot;target&quot;</span><span class="p">,</span><span class="s2">&quot;guide_identity&quot;</span><span class="p">,</span><span class="s1">&#39;12-X-global-X-all_G2M-transition&#39;</span><span class="p">,</span><span class="s1">&#39;80-X-global-X-all_G1S-transition&#39;</span><span class="p">]]</span>
<span class="n">dataframe_spectra_gene_sub_sub</span><span class="o">=</span><span class="n">dataframe_spectra_gene_sub</span><span class="p">[</span><span class="n">dataframe_spectra_gene_sub</span><span class="p">[</span><span class="s2">&quot;guide_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;ESR1_AP&quot;</span><span class="p">,</span><span class="s2">&quot;ESR1_MP&quot;</span><span class="p">,</span><span class="s2">&quot;non-targeting_Control&quot;</span><span class="p">])]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dataframe_spectra_gene_sub_sub</span><span class="p">[</span><span class="s2">&quot;guide_id&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">dataframe_spectra_gene_sub_sub</span><span class="p">[</span><span class="s2">&quot;guide_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">dataframe_spectra_gene_sub_melt</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">dataframe_spectra_gene_sub_sub</span><span class="p">,</span> <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;guide_id&quot;</span><span class="p">,</span><span class="s2">&quot;target&quot;</span><span class="p">,</span><span class="s2">&quot;guide_identity&quot;</span><span class="p">],</span> <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;12-X-global-X-all_G2M-transition&#39;</span><span class="p">,</span><span class="s1">&#39;80-X-global-X-all_G1S-transition&#39;</span><span class="p">])</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataframe_spectra_gene</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">dataframe_spectra_gene</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;guide&quot;</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Index([&#39;guide_identity&#39;, &#39;guide_read_count&#39;, &#39;guide_UMI_count&#39;,
       &#39;guide_coverage&#39;, &#39;guide_target&#39;, &#39;num_guides&#39;, &#39;ideal_guide&#39;,
       &#39;correct_num_guides&#39;, &#39;guide_no&#39;, &#39;guide_id&#39;, &#39;guide_assignment&#39;],
      dtype=&#39;object&#39;)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dataframe_spectra_gene_sub_melt</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;guide_id&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">)</span>
<span class="c1">#check the statistically difference</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Axes: xlabel=&#39;variable&#39;, ylabel=&#39;value&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/scripts_3_analysis_scripts_11_spectra_11_1.png" src="../../_images/scripts_3_analysis_scripts_11_spectra_11_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">scipy</span>
<span class="n">a</span><span class="o">=</span><span class="n">dataframe_spectra_gene_sub_melt</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">][(</span><span class="n">dataframe_spectra_gene_sub_melt</span><span class="p">[</span><span class="s2">&quot;guide_id&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;ESR1_MP&quot;</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">dataframe_spectra_gene_sub_melt</span><span class="p">[</span><span class="s2">&quot;variable&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;12-X-global-X-all_G2M-transition&quot;</span><span class="p">)]</span>
<span class="n">b</span><span class="o">=</span><span class="n">dataframe_spectra_gene_sub_melt</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">][(</span><span class="n">dataframe_spectra_gene_sub_melt</span><span class="p">[</span><span class="s2">&quot;guide_id&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;ESR1_AP&quot;</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">dataframe_spectra_gene_sub_melt</span><span class="p">[</span><span class="s2">&quot;variable&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;12-X-global-X-all_G2M-transition&quot;</span><span class="p">)]</span>
<span class="n">stat</span><span class="p">,</span> <span class="n">pvalue</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="n">pvalue</span>

<span class="c1"># sns.boxplot(data=dataframe_spectra_gene_sub, x=&quot;variable&quot;, y=&quot;value&quot;, hue=&quot;guide_id&quot;)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.1393351839024466
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#   and calculate the  variance per  column</span>
<span class="n">dataframe_spectra_five</span><span class="o">=</span><span class="n">dataframe_spectra</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="c1">#calculate the median value of p1</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#plot boxplot of the top 8 gene ontology</span>
<span class="c1">#remove columns that end with X-7 or X-124</span>
<span class="n">dataframe_spectra_boxplot</span><span class="o">=</span><span class="n">dataframe_spectra</span><span class="p">[</span><span class="n">dataframe_spectra</span><span class="p">[</span><span class="n">dataframe_spectra</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="o">~</span><span class="n">dataframe_spectra</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s2">&quot;132|148|25|22|28|39|114&quot;</span><span class="p">)]]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">melt</span><span class="p">()</span>
<span class="n">dataframe_spectra_boxplot</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">loc</span><span class="o">+</span><span class="s2">&quot;files/spectra_boxplot.csv&quot;</span><span class="p">)</span>
<span class="c1"># dataframe_spectra_boxplot=dataframe_spectra[dataframe_spectra.mean(axis=0).sort_values(ascending=False).head(8).index].melt()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dataframe_spectra_boxplot</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Spectra Score&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Specta Label&quot;</span><span class="p">)</span>
<span class="c1">#make prettier</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">loc</span><span class="o">+</span><span class="s2">&quot;figures/spectra_boxplot.pdf&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/scripts_3_analysis_scripts_11_spectra_14_0.png" src="../../_images/scripts_3_analysis_scripts_11_spectra_14_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#cellcycle</span>
<span class="n">cellcycle</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;12-X-global-X-all_G2M-transition&quot;</span><span class="p">,</span><span class="s2">&quot;80-X-global-X-all_G1S-transition&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean_df_list</span><span class="o">=</span><span class="p">[]</span>
<span class="n">corr_list</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">gene</span> <span class="ow">in</span> <span class="n">gene_list</span><span class="p">:</span>
    <span class="n">gene_adata</span><span class="o">=</span><span class="n">adata</span><span class="p">[</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s2">&quot;guide_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">gene</span><span class="o">+</span><span class="s2">&quot;_MP&quot;</span><span class="p">,</span><span class="n">gene</span><span class="o">+</span><span class="s2">&quot;_AP&quot;</span><span class="p">]),:]</span>
    <span class="n">dataframe_spectra_gene</span><span class="o">=</span><span class="n">dataframe_spectra</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">gene_adata</span><span class="o">.</span><span class="n">obs</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">min_cells</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">dataframe_spectra_gene</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;guide_id&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>
    <span class="n">dataframe_spectra_gene_guide</span><span class="o">=</span><span class="n">dataframe_spectra_gene</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;guide_id&quot;</span><span class="p">)[</span><span class="n">dataframe_spectra_columns</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">min_cells</span><span class="p">))</span>
    <span class="n">dataframe_spectra_gene_guide</span><span class="o">.</span><span class="n">index</span>
    <span class="n">p1</span><span class="o">=</span><span class="n">dataframe_spectra_gene_guide</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">dataframe_spectra_gene_guide</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;guide_id&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">gene</span><span class="o">+</span><span class="s2">&quot;_AP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">p2</span><span class="o">=</span><span class="n">dataframe_spectra_gene_guide</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">dataframe_spectra_gene_guide</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="s1">&#39;guide_id&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">gene</span><span class="o">+</span><span class="s2">&quot;_MP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1">##create a new column with gene name and the correlation across all the columns</span>
    <span class="n">mean_df_p1</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="n">cellcycle</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">mean_df_p1</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">gene</span><span class="o">+</span><span class="s2">&quot;_P1&quot;</span><span class="p">]</span>
    <span class="n">mean_df_p2</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="n">cellcycle</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">mean_df_p2</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">gene</span><span class="o">+</span><span class="s2">&quot;_P2&quot;</span><span class="p">]</span>
    <span class="c1">#merge together</span>
    <span class="n">mean_df</span><span class="o">=</span><span class="n">mean_df_p1</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">mean_df_p2</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">mean_df_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean_df</span><span class="p">)</span>
    <span class="n">correlation_df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">corrwith</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;spearman&quot;</span> <span class="p">))</span>
    <span class="n">correlation_df</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">gene</span><span class="p">]</span>
    <span class="n">corr_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">correlation_df</span><span class="p">)</span>
    <span class="c1"># df.groupby(&#39;ID&#39;)[[&#39;Val1&#39;,&#39;Val2&#39;]].corr().iloc[0::2,-1]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:6: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  min_cells=min(dataframe_spectra_gene.groupby(&#34;guide_id&#34;).size())
/var/folders/r_/bqnt2f_d6919cz7v1yzx2ykc0000gn/T/ipykernel_32712/4170490404.py:7: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  dataframe_spectra_gene_guide=dataframe_spectra_gene.groupby(&#34;guide_id&#34;)[dataframe_spectra_columns].apply(lambda x: x.sample(min_cells))
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr_df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">corr_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">mean_df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">mean_df_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#melt with index values</span>
<span class="n">mean_df_melt</span><span class="o">=</span><span class="n">mean_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
<span class="n">mean_df_melt</span><span class="p">[</span><span class="s2">&quot;gene&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">mean_df_melt</span><span class="p">[</span><span class="s2">&quot;variable&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">mean_df_melt</span><span class="p">[</span><span class="s2">&quot;promoter&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">mean_df_melt</span><span class="p">[</span><span class="s2">&quot;variable&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean_df_melt_10_pivot</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">mean_df_melt</span><span class="p">[</span><span class="n">mean_df_melt</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;12-X-global-X-all_G2M-transition&quot;</span><span class="p">],</span> <span class="n">values</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s2">&quot;gene&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;promoter&quot;</span><span class="p">)</span>
<span class="n">mean_df_melt_70_pivot</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">mean_df_melt</span><span class="p">[</span><span class="n">mean_df_melt</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;80-X-global-X-all_G1S-transition&quot;</span><span class="p">],</span> <span class="n">values</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s2">&quot;gene&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;promoter&quot;</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#read in the significant genes from edistance</span>
<span class="c1"># files/significant_genes.csv</span>
<span class="n">significant_genes</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">loc</span><span class="o">+</span><span class="s2">&quot;files/significant_genes.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%capture</span>
<span class="n">mean_df_melt_10_pivot_sub</span><span class="o">=</span><span class="n">mean_df_melt_10_pivot</span><span class="p">[</span><span class="n">mean_df_melt_10_pivot</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">significant_genes</span><span class="p">[</span><span class="s2">&quot;gene&quot;</span><span class="p">])]</span>
<span class="n">mean_df_melt_10_pivot_sub</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s2">&quot;diff&quot;</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">mean_df_melt_10_pivot_sub</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s2">&quot;P2&quot;</span><span class="p">]</span><span class="o">-</span><span class="n">mean_df_melt_10_pivot_sub</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s2">&quot;P1&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>
<span class="n">mean_df_melt_10_pivot_sub</span><span class="o">=</span><span class="n">mean_df_melt_10_pivot_sub</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;diff&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1">#repeat for mean_df_melt_70_pivot</span>
<span class="n">mean_df_melt_70_pivot_sub</span><span class="o">=</span><span class="n">mean_df_melt_70_pivot</span><span class="p">[</span><span class="n">mean_df_melt_70_pivot</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">significant_genes</span><span class="p">[</span><span class="s2">&quot;gene&quot;</span><span class="p">])]</span>
<span class="n">mean_df_melt_70_pivot_sub</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s2">&quot;diff&quot;</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">mean_df_melt_70_pivot_sub</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s2">&quot;P2&quot;</span><span class="p">]</span><span class="o">-</span><span class="n">mean_df_melt_70_pivot_sub</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s2">&quot;P1&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>
<span class="n">mean_df_melt_70_pivot_sub</span><span class="o">=</span><span class="n">mean_df_melt_70_pivot_sub</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;diff&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[70]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#put the two mean_df_melt_10_pivot_sub and mean_df_melt_70_pivot_sub into file</span>
<span class="n">mean_df_melt_10_pivot_sub</span><span class="p">[[</span><span class="s2">&quot;P1&quot;</span><span class="p">,</span><span class="s2">&quot;P2&quot;</span><span class="p">]][</span><span class="n">mean_df_melt_10_pivot_sub</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">significant_genes</span><span class="p">[</span><span class="s2">&quot;gene&quot;</span><span class="p">][</span><span class="n">significant_genes</span><span class="p">[</span><span class="s2">&quot;successfulKD&quot;</span><span class="p">]</span><span class="o">==</span><span class="kc">True</span><span class="p">])]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">loc</span><span class="o">+</span><span class="s2">&quot;files/mean_df_melt_10_pivot_sub.csv&quot;</span><span class="p">)</span>
<span class="n">mean_df_melt_70_pivot_sub</span><span class="p">[[</span><span class="s2">&quot;P1&quot;</span><span class="p">,</span><span class="s2">&quot;P2&quot;</span><span class="p">]][</span><span class="n">mean_df_melt_70_pivot_sub</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">significant_genes</span><span class="p">[</span><span class="s2">&quot;gene&quot;</span><span class="p">][</span><span class="n">significant_genes</span><span class="p">[</span><span class="s2">&quot;successfulKD&quot;</span><span class="p">]</span><span class="o">==</span><span class="kc">True</span><span class="p">])]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">loc</span><span class="o">+</span><span class="s2">&quot;files/mean_df_melt_70_pivot_sub.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#plot two heatmaps one for index=10-X-global-X-all_G2M-transition</span>
<span class="c1">#two plots side by side</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="c1">#make larger</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_figheight</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="c1">#make text smaller</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">mean_df_melt_10_pivot_sub</span><span class="p">[[</span><span class="s2">&quot;P1&quot;</span><span class="p">,</span><span class="s2">&quot;P2&quot;</span><span class="p">]][</span><span class="n">mean_df_melt_10_pivot_sub</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">significant_genes</span><span class="p">[</span><span class="s2">&quot;gene&quot;</span><span class="p">])],</span><span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdBu&quot;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="c1">#make text smaller and the size of plot smaller</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">mean_df_melt_70_pivot_sub</span><span class="p">[[</span><span class="s2">&quot;P1&quot;</span><span class="p">,</span><span class="s2">&quot;P2&quot;</span><span class="p">]][</span><span class="n">mean_df_melt_70_pivot_sub</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">significant_genes</span><span class="p">[</span><span class="s2">&quot;gene&quot;</span><span class="p">])],</span><span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdBu&quot;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="c1">#make sma\</span>
<span class="c1">#title LHS   B21E54  EE3968 7C53A2 33669A 3A54A5</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;G2M Transition&quot;</span><span class="p">)</span>
<span class="c1">#title RHS</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;G1S Transition&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">loc</span><span class="o">+</span><span class="s2">&quot;figures/spectra_heatmap_G2M.pdf&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/scripts_3_analysis_scripts_11_spectra_23_0.png" src="../../_images/scripts_3_analysis_scripts_11_spectra_23_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#s</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#sort according to the mean of the P1</span>
<span class="n">mean_df_melt_10_pivot</span><span class="o">=</span><span class="n">mean_df_melt_10_pivot</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;P1&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">mean_df_melt_70_pivot</span><span class="o">=</span><span class="n">mean_df_melt_70_pivot</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;P1&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1">#plot two heatmaps one for index=10-X-global-X-all_G2M-transition</span>
<span class="c1">#two plots side by side</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="c1">#make larger</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_figheight</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="c1">#make text smaller</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">mean_df_melt_10_pivot</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdBu&quot;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="c1">#make text smaller and the size of plot smaller</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">mean_df_melt_70_pivot</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdBu&quot;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="c1">#make sma\</span>
<span class="c1">#title LHS</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;G2M Transition&quot;</span><span class="p">)</span>
<span class="c1">#title RHS</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;G1S Transition&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">loc</span><span class="o">+</span><span class="s2">&quot;figures/spectra_heatmap_G2M.pdf&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/scripts_3_analysis_scripts_11_spectra_25_0.png" src="../../_images/scripts_3_analysis_scripts_11_spectra_25_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#plot the spectra scores for the ESR1_P1, ESR1_P2 and nontargeting</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">40</span><span class="p">))</span>
<span class="n">dataframe_spectra_esr1_melt</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">dataframe_spectra_gene</span><span class="p">,</span> <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;guide_id&quot;</span><span class="p">],</span> <span class="n">value_vars</span><span class="o">=</span><span class="n">dataframe_spectra_columns</span><span class="p">)</span>
<span class="n">grouped</span> <span class="o">=</span> <span class="n">dataframe_spectra_esr1_melt</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="s1">&#39;variable&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;variable&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">median</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dataframe_spectra_esr1_melt</span><span class="p">,</span><span class="n">y</span><span class="o">=</span> <span class="s2">&quot;variable&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span><span class="n">hue</span><span class="o">=</span><span class="s2">&quot;guide_id&quot;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="n">grouped</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="c1">#do</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Axes: xlabel=&#39;value&#39;, ylabel=&#39;variable&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/scripts_3_analysis_scripts_11_spectra_26_1.png" src="../../_images/scripts_3_analysis_scripts_11_spectra_26_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#visualize factor cell scores (this is poorly fitted bc we only ran 2 epochs)</span>
<span class="c1"># factor_of_interest = adata.uns[&#39;SPECTRA_overlap&#39;].index[80]</span>
<span class="n">factor_of_interest</span> <span class="o">=</span><span class="s2">&quot;80-X-global-X-all_G1S-transition&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;plotting factor:&#39;</span><span class="p">,</span><span class="n">factor_of_interest</span><span class="p">)</span>

<span class="c1">#add cell scores to obs</span>
<span class="n">cell_scores</span> <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">obsm</span><span class="p">[</span><span class="s1">&#39;SPECTRA_cell_scores&#39;</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="n">factor_of_interest</span><span class="p">]</span> <span class="o">=</span> <span class="n">cell_scores</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">factor_of_interest</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">cell_scores</span><span class="p">,</span><span class="mf">0.98</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
plotting factor: 80-X-global-X-all_G1S-transition
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/scripts_3_analysis_scripts_11_spectra_27_1.png" src="../../_images/scripts_3_analysis_scripts_11_spectra_27_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">factors</span> <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">uns</span><span class="p">[</span><span class="s1">&#39;SPECTRA_factors&#39;</span><span class="p">]</span> <span class="c1"># factors x genes matrix that tells you how important each gene is to the resulting factors</span>
<span class="n">markers</span> <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">uns</span><span class="p">[</span><span class="s1">&#39;SPECTRA_markers&#39;</span><span class="p">]</span> <span class="c1"># factors x n_top_vals list of n_top_vals top markers per factor</span>
<span class="n">cell_scores</span> <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">obsm</span><span class="p">[</span><span class="s1">&#39;SPECTRA_cell_scores&#39;</span><span class="p">]</span> <span class="c1"># cells x factors matrix of cell scores</span>
<span class="n">vocab</span> <span class="o">=</span> <span class="n">adata</span><span class="o">.</span><span class="n">var</span><span class="p">[</span><span class="s1">&#39;spectra_vocab&#39;</span><span class="p">]</span> <span class="c1"># boolean matrix of size # of genes that indicates the set of genes used to fit spectra</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">adata</span><span class="o">.</span><span class="n">uns</span><span class="p">[</span><span class="s1">&#39;SPECTRA_overlap&#39;</span><span class="p">])</span> <span class="c1"># overlap matrix of size factors x factors that tells you how much each factor overlaps with each other factor</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Axes: &gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/scripts_3_analysis_scripts_11_spectra_28_1.png" src="../../_images/scripts_3_analysis_scripts_11_spectra_28_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#subset esr1 only</span>
<span class="n">adata_esr1</span> <span class="o">=</span> <span class="n">adata</span><span class="p">[</span><span class="n">adata</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s2">&quot;guide_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;ESR1_MP&quot;</span><span class="p">,</span><span class="s2">&quot;ESR1_AP&quot;</span><span class="p">,</span><span class="s2">&quot;non-targeting_Control&quot;</span><span class="p">])]</span>
<span class="c1">#plot</span>
<span class="n">sc</span><span class="o">.</span><span class="n">pl</span><span class="o">.</span><span class="n">umap</span><span class="p">(</span><span class="n">adata_esr1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;guide_id&quot;</span><span class="p">,</span><span class="s2">&quot;80-X-global-X-all_G1S-transition&quot;</span><span class="p">],</span><span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">cell_scores</span><span class="p">,</span><span class="mf">0.98</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/helenking/anaconda3/envs/apu/lib/python3.12/site-packages/scanpy/plotting/_utils.py:487: ImplicitModificationWarning: Trying to modify attribute `._uns` of view, initializing view as actual.
  adata.uns[value_to_plot + &#34;_colors&#34;] = colors_list
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/scripts_3_analysis_scripts_11_spectra_29_1.png" src="../../_images/scripts_3_analysis_scripts_11_spectra_29_1.png" />
</div>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="7_cellphase_model.html" class="btn btn-neutral float-left" title="Cell Assignment Model from FUCCI-Matched Single-Cell Paper" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="9A_cnv_score.html" class="btn btn-neutral float-right" title="Investigating Copy Number Variation Across KD Populations" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2026, Helen King.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>